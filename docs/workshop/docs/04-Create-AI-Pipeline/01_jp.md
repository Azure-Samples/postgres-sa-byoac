# 4.1 ドキュメントインテリジェンスによるデータ抽出

Azure Document Intelligenceは、AIを使用してドキュメントからのデータ抽出と処理を自動化します。このセクションでは、AIを強化したデータ取り込みと処理パイプラインの詳細を提供します。

??? question "独自のデータを使用していますか？"
       独自のデータを使用する場合は、`../scripts/sql/deploy-database-tables.sql`の構造と形式をコピーし、*vendors*、*sows*、*sow_chunks*、*milestones*、*deliverables*、*sow_validation_results*、*invoices*、*invoice_line_items*、および*invoice_validation_results*テーブルのINSERT文を組み込む必要があります。

       さらに、データベースに**カスタム**テーブルやテーブル構造がある場合は、既存のスキーマに**データモデルをマッピング**するか、**スクリプトを修正**して独自のエンティティ関係を反映させる必要があります。**ベクトル列**と**インデックス戦略**がAIと検索のニーズに合致していることを確認し、データの一貫性と整合性を維持するためにクエリ、結合、および制約を適宜更新してください。

## ドキュメントのアップロードと取り込みワークフローの概要

1. プロセスは、請求書や作業範囲記述書（SOW）などの財務ドキュメントをアプリケーションUIを通じてアップロードすることから始まります。

1. インフラストラクチャのセットアップにより、ベンダー、作業範囲記述書、および請求書のサンプルデータがデータベースに投入されます。

1. Document Intelligenceにロードするためのサンプルドキュメントはリポジトリ内に提供されており、`../data/sample_docs`にあります。
    1. **Trey Research**ベンダーの請求書を完成させるために、`Exercise_1_Load_Invoices`フォルダーから請求書ドキュメントをロードできます。
    1. 次に、**Lucerne Publishing**ベンダーのために`Exercise_2_Load_SOW_Invoices`フォルダーから作業範囲記述書と3つの請求書をロードできます。
    1. 不正データをロードするには、`Exercise_3_Load_Bad_SOWandInv`フォルダーにドキュメントがあります。

    !!! info "独自のドキュメントを生成してロードする"

        独自のドキュメントを生成したい場合は、`../data/data_generator/src`にドキュメントジェネレーターがあります。READMEドキュメントの指示に従ってください。スクリプトを実行するには、Pythonをインストールし、requirements.txtに記載されている必要な依存関係をインストールする必要があります。

1. 新しいドキュメントがアップロードされると、**データ取り込みワークフロー**の開始時に**Azure Blob Storage**に保存されます。

1. **データ取り込みワークフロー**は、アップロードされたドキュメントを**Azure AI Document Intelligence サービス**に送信することで、データの抽出と処理を行います。

1. このソリューションは、**Document Intelligence**内の事前構築されたAIモデルを使用して、**プロジェクトの成果物、期限、請求可能金額、ベンダーの詳細**などのデータフィールドを分析します。これらのモデルは、請求書、SOW、契約書、領収書、身分証明書などの特定のドキュメントタイプ向けに設計されており、AIを活用した光学文字認識（OCR）と自然言語処理（NLP）を利用して関連データを抽出します。

1. ドキュメントが分析されると、モデルは以下を行います：
    1. 主要なフィールドを抽出し、信頼度スコアを割り当てます（例：「請求書合計：$1,250.00（信頼度：0.98）」）。
    1. 構造化されたJSONまたはキーと値のペアを使用してテーブルやラインアイテムを処理します。
    1. 抽出されたエンティティ間の関係を認識します（例：請求書番号を対応する期限日とリンクする）。

1. Document Intelligenceの**構造要素ベースのチャンク化**機能は、ドキュメントの構造を認識し、見出しをキャプチャし、段落や文などの意味的な一貫性に基づいてコンテンツ本体をチャンク化します。これにより、**Retrieval-Augmented Generation (RAG)** パターンのクエリで使用するためのチャンクの品質が向上します。

1. 抽出された後、ドキュメントデータは**Azure Database for PostgreSQL flexible server**に安全に保存されます。

1. データベース挿入ステートメントの一部として、`azure_ai`拡張機能の**GenAI機能**を活用して以下を行います：
    - **Azure OpenAI**を使用してドキュメントテキストの**ベクトル埋め込みを生成および保存**し、効率的なセマンティック検索と取得を可能にします。
    - **Azure AI Language サービス**を使用して作業範囲記述書（SOW）の**抽出要約を作成**し、長いドキュメントから重要な洞察を簡潔で実用的な要約に凝縮します。

1. 独自のドキュメントをお持ちの場合は、アプリケーションUIを使用してそれらをブロブストレージにロードし、AIサービスへの取り込みパイプラインをトリガーすることができます。

## AIによるデータ取り込みと検証の強化

**Azure Document Intelligence** は、AI駆動の検証を適用して正確性を確保しながら、構造化および非構造化データを抽出します。

**自動テキスト抽出**: 取引金額や顧客情報などの主要なフィールドを識別します。
**AI駆動のデータ検証**: 抽出されたデータを事前定義されたルールと照合してコンプライアンスを確保します。
**構造要素に基づくチャンク化**: 大規模なドキュメントを効率的に処理するために意味のある部分に分割します。

## 強化されたパイプラインの利点

- **高品質なデータ**: AI駆動の検証により正確性を確保します。
- **スケーラビリティ**: 大量のドキュメントを効率的に処理します。
- **セマンティック理解**: AIによる検索と分析を可能にします。
- **エンドツーエンドの自動化**: ドキュメント処理のワークフローを効率化します。

**Azure Document Intelligence** を活用することで、非構造化ドキュメントを効率的に実用的なインサイトに変換できます。

## 追加の学習リファレンス

- [Azure AI Document Intelligence ドキュメント](https://learn.microsoft.com/azure/ai-services/document-intelligence/)
- [Azure Document Intelligence コードサンプル](https://learn.microsoft.com/samples/azure-samples/document-intelligence-code-samples/document-intelligence-code-samples/)
