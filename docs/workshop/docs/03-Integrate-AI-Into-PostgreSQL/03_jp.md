# 3.3 ベクターストレージを有効にする

**pgvector** 拡張機能は、PostgreSQL にベクターデータをネイティブに扱う能力を与える最先端の追加機能です。この機能により、ベクター情報を保存およびクエリすることが可能になり、コパイロット、推薦システム、類似検索を含むアプリケーションに最適です。ベクター埋め込みを PostgreSQL データベースの他のデータと一緒に保存できるようにするには、埋め込みを保存したいテーブルを変更して、拡張機能によって提供される `vector` データ型の列を追加する必要があります。

## ベクターとは何ですか？

ベクター、または埋め込みやベクター埋め込みとも呼ばれるものは、高次元空間でデータを表現する数学的構造です。この空間の各次元はデータの特定の特徴に対応しており、複雑なデータは数万の次元を使用して表現されることがあります。この空間におけるベクターの位置は、その独自の属性を捉えています。単語、フレーズ、文書全体、画像、音声など、さまざまな種類のデータをベクターに変換することができます。ベクター検索を使用することで、この統一された表現のおかげで、異なる種類のデータ間で類似したデータを見つけることが可能です。

埋め込みは、機械学習モデルやアルゴリズムが効果的に活用できる密で情報豊富なデータ形式です。埋め込みは、テキストの意味を浮動小数点数のベクターの形でカプセル化します。その結果、ベクタースペース内の2つの埋め込みの近接性は、元の入力間の意味的類似性を反映しています。

## テーブルにベクター列を追加する

**pgvector** 拡張機能によってインストールされる `vector` データ型は、PostgreSQL データベース内で高次元の数値ベクターを効率的に保存および操作することを可能にします。これらのベクターは、テキスト埋め込み、画像特徴、ユーザーの好みなど、幅広いデータを表す数値の配列です。

以下では、`deliverables`、`invoice_line_items`、`invoice_validation_results`、`sow_chunks`、および `sow_validation_results` テーブルに `vector` 列を追加します。これらのテーブルのそれぞれには、テキストのブロックを保存する列が含まれています。ベクター埋め込みは、それらが表すテキストと一緒に保存されます。

!!! info "ベクトル列のサイズは、使用している埋め込みモデルによって生成される次元数に対応している必要があります。このソリューションでは、OpenAIの`text-embedding-ada-002`モデルを使用し、1,536次元を返すように設定されています。この数値は、以下のテーブルに追加されるベクトル列のサイズに反映されています。"

**pgAdmin**を使用して、各テーブルに対して**contracts**データベースでSQLステートメントを実行します。

!!! danger "_以下の各テーブルのタブを選択し、ベクトルデータを格納するための`embedding`列を作成するための`ALTER TABLE`ステートメントを実行してください。_"

=== "deliverables"

    以下のSQLステートメントをpgAdminの新しいクエリウィンドウにコピー＆ペーストし、埋め込みベクトル列を追加するためにクエリを実行します。

    ```sql
    ALTER TABLE deliverables ADD COLUMN IF NOT EXISTS embedding vector(1536);
    ```

=== "invoice_line_items"

    以下のSQLステートメントをpgAdminの新しいクエリウィンドウにコピー＆ペーストし、埋め込みベクトル列を追加するためにクエリを実行します。

    ```sql
    ALTER TABLE invoice_line_items ADD COLUMN IF NOT EXISTS embedding vector(1536);
    ```

=== "invoice_validation_results"

    以下のSQLステートメントをpgAdminの新しいクエリウィンドウにコピー＆ペーストし、埋め込みベクトル列を追加するためにクエリを実行します。

    ```sql
    ALTER TABLE invoice_validation_results ADD COLUMN IF NOT EXISTS embedding vector(1536);
    ```

=== "sow_chunks"

    以下のSQLステートメントをpgAdminの新しいクエリウィンドウにコピー＆ペーストし、埋め込みベクトル列を追加するためにクエリを実行します。
    
    ```sql
    ALTER TABLE sow_chunks ADD COLUMN IF NOT EXISTS embedding vector(1536);
    ```

=== "sow_validation_results"

    以下のSQLステートメントをpgAdminの新しいクエリウィンドウにコピー＆ペーストし、埋め込みベクトル列を追加するためにクエリを実行します。

    ```sql
    ALTER TABLE sow_validation_results ADD COLUMN IF NOT EXISTS embedding vector(1536);
    ```

!!! danger "次のステップに進む前に、すべての埋め込み列を追加するために各テーブルの`ALTER TABLE`ステートメントを必ず実行してください。"

It seems like you haven't pasted any content yet. Please provide the Markdown content you want translated, and I'll assist you with the translation.
